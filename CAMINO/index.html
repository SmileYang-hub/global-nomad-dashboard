<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å“†å•¦Aå¤¢æœè–ä¹‹è·¯ App (Camino GO!)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Iansui&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dora: {
                            blue: '#009BDE',
                            red: '#E4002B',
                            yellow: '#F1C40F',
                            bg: '#F0F9FF', // æ¥µæ·ºè—
                        }
                    },
                    fontFamily: {
                        sans: ['Iansui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Global Reset & Base Styles */
        body {
            background-color: #F0F9FF;
            font-family: 'Iansui', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* é˜²æ­¢ iOS æ‹‰å‹•å›å½ˆ */
        }

        /* Glassmorphism Card Utility */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        /* Hide Scrollbar but allow scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Input Focus Ring Customization */
        input:focus, select:focus {
            outline: none;
            ring: 2px solid #009BDE;
        }
    </style>
</head>
<body class="text-slate-800 pb-24">

    <header class="fixed top-0 left-0 w-full z-50 glass-card rounded-b-[2rem] px-6 py-4 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-dora-yellow border-2 border-black/10 flex items-center justify-center shadow-inner">
                <div class="w-6 h-1 bg-black/20 rounded-full"></div>
            </div>
            <h1 class="text-xl font-bold text-dora-blue tracking-wider">Camino GO!</h1>
        </div>
        <button class="relative p-2 rounded-full hover:bg-blue-50 transition-colors">
            <i data-lucide="bell" class="w-6 h-6 text-dora-blue"></i>
            <span class="absolute top-1 right-1 w-2.5 h-2.5 bg-dora-red rounded-full border border-white"></span>
        </button>
    </header>

    <main id="app-container" class="pt-24 px-4 max-w-lg mx-auto min-h-screen">
        <div id="loading" class="flex flex-col items-center justify-center h-[50vh] text-dora-blue">
            <i data-lucide="loader-2" class="w-10 h-10 animate-spin mb-4"></i>
            <p>æ­£åœ¨å¾ç™¾å¯¶è¢‹æ‹¿å‡ºè³‡æ–™...</p>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 w-full h-[80px] bg-white shadow-[0_-5px_20px_rgba(0,0,0,0.05)] rounded-t-[2rem] z-50 flex justify-around items-center px-2">
        <button onclick="switchTab('route')" class="nav-btn group flex flex-col items-center gap-1 w-20 transition-all" data-target="route">
            <div class="p-2 rounded-2xl group-[.active]:bg-blue-50 transition-colors">
                <i data-lucide="map" class="w-6 h-6 text-gray-400 group-[.active]:text-dora-blue transition-colors"></i>
            </div>
            <span class="text-xs font-bold text-gray-400 group-[.active]:text-dora-blue">è¡Œç¨‹</span>
        </button>
        
        <button onclick="switchTab('toolkit')" class="nav-btn group flex flex-col items-center gap-1 w-20 transition-all" data-target="toolkit">
            <div class="p-2 rounded-2xl group-[.active]:bg-blue-50 transition-colors">
                <i data-lucide="backpack" class="w-6 h-6 text-gray-400 group-[.active]:text-dora-blue transition-colors"></i>
            </div>
            <span class="text-xs font-bold text-gray-400 group-[.active]:text-dora-blue">ç™¾å¯¶è¢‹</span>
        </button>

        <button onclick="switchTab('expense')" class="nav-btn group flex flex-col items-center gap-1 w-20 transition-all" data-target="expense">
            <div class="p-2 rounded-2xl group-[.active]:bg-blue-50 transition-colors">
                <i data-lucide="wallet" class="w-6 h-6 text-gray-400 group-[.active]:text-dora-blue transition-colors"></i>
            </div>
            <span class="text-xs font-bold text-gray-400 group-[.active]:text-dora-blue">è¨˜å¸³</span>
        </button>
    </nav>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let rawData = {
            stages: [],
            itinerary: [],
            toolkit: []
        };
        let currentStageId = "1";
        
        // --- 1. è³‡æ–™è®€å–å¼•æ“ (Data Engine) ---
        
        const cleanCSV = (text) => text.replace(/^"|"$/gm, '').trim();

        const fetchCSV = (filename) => {
            return new Promise((resolve, reject) => {
                fetch(filename)
                    .then(response => {
                        if (!response.ok) throw new Error(`ç„¡æ³•è®€å– ${filename}`);
                        return response.text();
                    })
                    .then(text => {
                        const cleanedText = cleanCSV(text);
                        Papa.parse(cleanedText, {
                            header: true,
                            skipEmptyLines: true,
                            complete: (results) => resolve(results.data),
                            error: (err) => reject(err)
                        });
                    })
                    .catch(err => {
                        console.error("Fetch Error:", err);
                        // é˜²å‘†ï¼šå¦‚æœæ˜¯æœ¬æ©Ÿæ¸¬è©¦æ²’é–‹ Serverï¼Œå¯èƒ½æœƒå¤±æ•—ï¼Œé€™é‚Šå›å‚³ç©ºé™£åˆ—é¿å…å¡æ­»
                        resolve([]); 
                    });
            });
        };

        const initApp = async () => {
            try {
                const [stages, itinerary, toolkit] = await Promise.all([
                    fetchCSV('camino_stages.csv'),
                    fetchCSV('camino_itinerary.csv'),
                    fetchCSV('camino_toolkit.csv')
                ]);

                rawData.stages = stages;
                rawData.itinerary = itinerary;
                rawData.toolkit = toolkit;

                document.getElementById('loading').remove();
                switchTab('route'); // é è¨­é–‹å•Ÿè¡Œç¨‹é 
                
            } catch (error) {
                document.getElementById('app-container').innerHTML = `
                    <div class="text-center text-dora-red p-10">
                        <h2 class="text-2xl font-bold">ç³Ÿç³•ï¼</h2>
                        <p>è®€å–è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¢ºèª CSV æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚</p>
                        <p class="text-xs mt-4 text-gray-400">${error.message}</p>
                    </div>
                `;
            }
        };

        // --- æ ¸å¿ƒå°èˆªé‚è¼¯ ---
        
        const switchTab = (tabName) => {
            // UI Update
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.target === tabName) {
                    btn.classList.add('active');
                    // Add bounce animation logic if needed
                } else {
                    btn.classList.remove('active');
                }
            });

            // Content Render
            const container = document.getElementById('app-container');
            container.innerHTML = ''; // Clear current content
            window.scrollTo(0, 0);

            if (tabName === 'route') renderRoute(container);
            if (tabName === 'toolkit') renderToolkit(container);
            if (tabName === 'expense') renderExpense(container);
            
            lucide.createIcons(); // Re-init icons
        };

        const scrollToTop = () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        // --- 2. ç¬¬ä¸€åˆ†é ï¼šè¡Œç¨‹ (Route) ---

        const renderRoute = (container) => {
            // A. éšæ®µé¸æ“‡å™¨
            const selectorHtml = `
                <div class="glass-card p-2 rounded-[2rem] mb-6 flex items-center shadow-sm">
                    <div class="bg-blue-100 p-2 rounded-full mr-2">
                        <i data-lucide="map-pin" class="text-dora-blue"></i>
                    </div>
                    <select id="stage-select" class="w-full bg-transparent text-blue-900 font-bold text-lg p-2 focus:outline-none appearance-none">
                        ${rawData.stages.map(s => `<option value="${s.ID}" ${s.ID === currentStageId ? 'selected' : ''}>${s.Title}</option>`).join('')}
                    </select>
                    <i data-lucide="chevron-down" class="text-gray-400 mr-2"></i>
                </div>
            `;
            
            // B. Hero å€å¡Š
            const currentStage = rawData.stages.find(s => s.ID === currentStageId) || rawData.stages[0];
            // é˜²å‘†ï¼šè‹¥ç„¡åœ–ç‰‡å‰‡ä½¿ç”¨ Placeholderï¼Œå¯¦éš›è«‹ä¾éœ€æ±‚æ”¹ç‚º img/s{ID}_hero.jpg
            const imgSrc = `img/s${currentStage.ID}_hero.jpg`; 
            
            const heroHtml = `
                <div class="relative w-full h-64 rounded-[2rem] overflow-hidden shadow-lg mb-0 group">
                    <img src="${imgSrc}" 
                         onerror="this.src='https://images.unsplash.com/photo-1551632811-561732d1e306?q=80&w=1000&auto=format&fit=crop'" 
                         class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700" alt="Stage Hero">
                    
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex items-end p-6 pb-8">
                        <h2 class="text-white text-2xl font-bold drop-shadow-md">${currentStage.Title.split(':')[0]}</h2>
                    </div>
                </div>

                <div class="glass-card relative -mt-6 mx-4 p-5 rounded-[2rem] shadow-md z-10 mb-8">
                    <p class="text-blue-900 font-bold leading-relaxed text-justify">
                        ğŸ“ ${currentStage.Description}
                    </p>
                </div>
            `;

            // C. åŸå¸‚å¡ç‰‡åˆ—è¡¨ (Filter Loop)
            const filteredCities = rawData.itinerary.filter(city => city.StageID === currentStageId);
            
            const cardsHtml = filteredCities.map(city => {
                // Tips Logic
                let tipsHtml = '';
                if(city.Tip1) tipsHtml += `<span class="inline-block px-3 py-1 bg-blue-50 text-blue-700 text-sm font-bold rounded-full mb-2 mr-2">ğŸ’¡ ${city.Tip1}</span>`;
                if(city.Tip2) tipsHtml += `<span class="inline-block px-3 py-1 bg-pink-50 text-pink-700 text-sm font-bold rounded-full mb-2 mr-2">ğŸŒ¸ ${city.Tip2}</span>`;
                if(city.Tip3) tipsHtml += `<span class="inline-block px-3 py-1 bg-yellow-50 text-yellow-700 text-sm font-bold rounded-full mb-2">â­ ${city.Tip3}</span>`;

                return `
                <div class="glass-card rounded-[2.5rem] p-6 mb-8 relative border-b-4 border-b-black/5">
                    <div onclick="scrollToTop()" class="absolute top-0 right-0 bg-dora-blue text-white font-black text-xl px-5 py-3 rounded-tr-[2.5rem] rounded-bl-[2rem] shadow-lg cursor-pointer active:scale-95 transition-transform z-20">
                        ${city.CityNo}
                    </div>

                    <div class="mt-4 mb-4 pr-16">
                        <h3 class="text-4xl font-black text-slate-800 break-words hyphens-auto leading-tight pr-2 mb-1">${city.CityEN}</h3>
                        <h4 class="text-lg text-gray-400 font-bold">${city.CityCN}</h4>
                    </div>

                    <p class="text-gray-600 leading-relaxed mb-4 text-justify">
                        ${city.Description}
                    </p>

                    <div class="mb-6 flex flex-wrap">
                        ${tipsHtml}
                    </div>

                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(city.CityEN)}" target="_blank" 
                       class="flex items-center justify-center gap-2 bg-dora-red text-white w-full py-3 rounded-full shadow-lg shadow-red-200 active:scale-95 transition-transform font-bold">
                        <span>ğŸ—ºï¸ é–‹å•Ÿä»»æ„é–€</span>
                    </a>
                </div>
                `;
            }).join('');

            container.innerHTML = selectorHtml + heroHtml + cardsHtml;

            // Selector Event Listener
            document.getElementById('stage-select').addEventListener('change', (e) => {
                currentStageId = e.target.value;
                renderRoute(container);
                lucide.createIcons();
            });
        };

        // --- 3. ç¬¬äºŒåˆ†é ï¼šç™¾å¯¶è¢‹ (Toolkit) ---

        const renderToolkit = (container) => {
            // åˆ†é¡å®šç¾©
            const categories = [
                { key: 'phrase', title: 'æ±‚ç”Ÿè¥¿èª', icon: 'languages', color: 'blue' },
                { key: 'sign', title: 'é‡è¦æ¨™èªŒ', icon: 'signpost', color: 'yellow' },
                { key: 'gear', title: 'è£å‚™æ¸…å–®', icon: 'backpack', color: 'green' },
                { key: 'tip', title: 'é‡è¦æé†’', icon: 'lightbulb', color: 'red' }
            ];

            // Quick Nav Grid
            let navGrid = '<div class="grid grid-cols-4 gap-2 mb-8">';
            categories.forEach(cat => {
                navGrid += `
                    <button onclick="document.getElementById('cat-${cat.key}').scrollIntoView({behavior: 'smooth', block: 'start'})" 
                            class="flex flex-col items-center justify-center p-3 rounded-2xl bg-${cat.color}-50 active:scale-95 transition-transform">
                        <i data-lucide="${cat.icon}" class="w-6 h-6 text-${cat.color}-500 mb-1"></i>
                        <span class="text-[10px] font-bold text-${cat.color}-600">${cat.title}</span>
                    </button>
                `;
            });
            navGrid += '</div>';

            // Content Loop
            let contentHtml = '';
            categories.forEach(cat => {
                const items = rawData.toolkit.filter(item => item.Category === cat.key);
                if (items.length === 0) return;

                contentHtml += `
                    <div id="cat-${cat.key}" class="mb-8 scroll-mt-24">
                        <h3 onclick="scrollToTop()" class="text-xl font-bold text-slate-700 mb-4 pl-3 border-l-4 border-dora-blue cursor-pointer">
                            ${cat.title}
                        </h3>
                        <div class="flex flex-col gap-4">
                `;

                items.forEach(item => {
                    // å³å´ç‰¹æ®ŠåŠŸèƒ½å€
                    let actionHtml = '';
                    if (cat.key === 'phrase') {
                        // TTS æŒ‰éˆ•
                        actionHtml = `
                            <button onclick="speak('${item.Title}', '${item.Note || 'es-ES'}')" class="shrink-0 w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center active:scale-90 transition-transform">
                                <i data-lucide="volume-2" class="w-5 h-5 text-blue-600"></i>
                            </button>
                        `;
                    } else if (cat.key === 'gear') {
                        // Checkbox
                        actionHtml = `
                            <label class="shrink-0 relative flex items-center p-2 rounded-full cursor-pointer">
                                <input type="checkbox" class="w-6 h-6 border-2 border-gray-300 rounded-md text-dora-blue focus:ring-0 checked:bg-green-500 checked:border-transparent transition-all">
                            </label>
                        `;
                    }

                    contentHtml += `
                        <div class="bg-white p-4 rounded-[1.5rem] flex items-center gap-4 shadow-sm border border-gray-100">
                            <div class="text-3xl shrink-0 select-none">${item.ItemIcon}</div>
                            
                            <div class="flex-1 min-w-0">
                                <p class="text-slate-800 font-black text-lg break-words whitespace-normal leading-tight">${item.Title}</p>
                                <p class="text-gray-400 text-sm font-bold break-words whitespace-normal mt-1">${item.Subtitle}</p>
                            </div>

                            ${actionHtml}
                        </div>
                    `;
                });

                contentHtml += `</div></div>`;
            });

            container.innerHTML = navGrid + contentHtml;
        };

        // TTS åŠŸèƒ½
        const speak = (text, lang) => {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang || 'es-ES';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            } else {
                alert("æ‚¨çš„è£ç½®ä¸æ”¯æ´èªéŸ³æœ—è®€åŠŸèƒ½ ğŸ˜­");
            }
        };

        // --- 4. ç¬¬ä¸‰åˆ†é ï¼šè¨˜å¸³ (Expense) ---

        const getExpenses = () => JSON.parse(localStorage.getItem('camino_exp_v2') || '[]');
        const saveExpenses = (data) => localStorage.setItem('camino_exp_v2', JSON.stringify(data));
        const EXCHANGE_RATE = 35.5;

        const renderExpense = (container) => {
            const expenses = getExpenses();
            
            // è¨ˆç®—ç¸½é¡
            const totalEur = expenses.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            const totalTwd = Math.round(totalEur * EXCHANGE_RATE);

            // ç¸½è¦½å¡ç‰‡
            const summaryHtml = `
                <div class="bg-gradient-to-r from-emerald-400 to-teal-500 rounded-[2rem] p-6 text-white shadow-lg mb-6 relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/20 rounded-full blur-xl"></div>
                    <p class="font-bold text-emerald-50 mb-1">ç›®å‰ç¸½èŠ±è²»</p>
                    <div class="flex items-baseline gap-2">
                        <span class="text-4xl font-black">â‚¬${totalEur.toFixed(1)}</span>
                        <span class="text-emerald-100">â‰ˆ NT$${totalTwd.toLocaleString()}</span>
                    </div>
                </div>
            `;

            // è¼¸å…¥å€å¡Š
            const today = new Date().toISOString().split('T')[0];
            const categories = [
                {name: 'ä½å®¿', icon: 'bed'}, 
                {name: 'é¤é£²', icon: 'utensils'}, 
                {name: 'äº¤é€š', icon: 'bus'}, 
                {name: 'è£å‚™', icon: 'backpack'}, 
                {name: 'é–€ç¥¨', icon: 'ticket'}, 
                {name: 'å…¶ä»–', icon: 'more-horizontal'}
            ];

            const formHtml = `
                <div class="glass-card p-5 rounded-[2rem] mb-6">
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        ${categories.map(c => `
                            <button onclick="fillCategory('${c.name}')" class="flex flex-col items-center justify-center py-2 bg-gray-50 rounded-xl hover:bg-blue-50 active:bg-blue-100 transition-colors">
                                <i data-lucide="${c.icon}" class="w-5 h-5 text-gray-400 mb-1"></i>
                                <span class="text-xs text-gray-500 font-bold">${c.name}</span>
                            </button>
                        `).join('')}
                    </div>

                    <div class="space-y-3">
                        <input type="date" id="exp-date" value="${today}" class="w-full bg-gray-50 p-3 rounded-xl border-none text-gray-600 font-bold">
                        
                        <input type="text" id="exp-item" placeholder="é …ç›®åç¨± (ä¾‹å¦‚ï¼šåˆé¤)" 
                               class="w-full bg-gray-50 p-3 rounded-xl border-none font-bold placeholder-gray-300"
                               onkeydown="handleEnter(event, 'exp-amount')">
                        
                        <div class="flex gap-3">
                            <input type="number" id="exp-amount" placeholder="é‡‘é¡ (â‚¬)" inputmode="decimal"
                                   class="w-2/3 bg-gray-50 p-3 rounded-xl border-none font-bold text-lg placeholder-gray-300"
                                   onkeydown="handleEnter(event, 'submit')">
                            
                            <button onclick="addExpense()" id="btn-add" class="w-1/3 bg-dora-blue text-white rounded-xl font-bold flex items-center justify-center shadow-md active:scale-95 transition-transform">
                                <i data-lucide="plus" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // åˆ—è¡¨å€å¡Š
            const listHtml = `
                <div class="flex justify-between items-center mb-4 px-2">
                    <h3 class="font-bold text-gray-500">æœ€è¿‘ç´€éŒ„</h3>
                    <button onclick="exportCSV()" class="text-xs text-dora-blue font-bold flex items-center gap-1 bg-white px-3 py-1 rounded-full shadow-sm">
                        <i data-lucide="download" class="w-3 h-3"></i> åŒ¯å‡º CSV
                    </button>
                </div>
                <div class="space-y-3 pb-8">
                    ${expenses.length === 0 ? '<div class="text-center text-gray-300 py-8">é‚„æ²’æœ‰è¨˜å¸³å–”ï¼<br>(å¯èƒ½ç”¨äº†ç©ºæ°£ç ²ä¸ç”¨éŒ¢?)</div>' : ''}
                    ${expenses.slice().reverse().map((item, index) => `
                        <div class="bg-white p-4 rounded-[1.5rem] flex justify-between items-center shadow-sm">
                            <div class="flex-1 min-w-0">
                                <div class="text-xs text-gray-400 font-mono mb-1">${item.date}</div>
                                <div class="font-bold text-slate-700 truncate">${item.title}</div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="font-black text-dora-blue text-lg">â‚¬${item.amount}</span>
                                <button onclick="deleteExpense(${expenses.length - 1 - index})" class="text-gray-300 hover:text-red-500 transition-colors">
                                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            container.innerHTML = summaryHtml + formHtml + listHtml;
        };

        // è¨˜å¸³äº’å‹•é‚è¼¯
        window.fillCategory = (name) => {
            const input = document.getElementById('exp-item');
            input.value = name + '-';
            input.focus();
        };

        window.handleEnter = (e, targetId) => {
            if (e.key === 'Enter') {
                if (targetId === 'submit') {
                    addExpense();
                } else {
                    document.getElementById(targetId).focus();
                }
            }
        };

        window.addExpense = () => {
            const date = document.getElementById('exp-date').value;
            const title = document.getElementById('exp-item').value;
            const amount = document.getElementById('exp-amount').value;

            if (!title || !amount) {
                alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Šï¼'); // ç°¡å–®é˜²å‘†
                return;
            }

            const expenses = getExpenses();
            expenses.push({ date, title, amount });
            saveExpenses(expenses);

            // é‡ç¹ªä¸¦é‡ç½® Focus
            const container = document.getElementById('app-container');
            renderExpense(container);
            lucide.createIcons();
            
            // è®“ä½¿ç”¨è€…å¯ä»¥é€£çºŒè¨˜å¸³ï¼šFocus å›ç¬¬ä¸€å€‹æ¬„ä½æˆ–æŒ‰éˆ•å€(é€™è£¡é¸æ“‡ Focus åç¨±)
            // ç¨å¾®å»¶é²ä»¥ç¢ºä¿ DOM æ›´æ–°
            setTimeout(() => {
                 document.getElementById('exp-item').focus();
            }, 50);
        };

        window.deleteExpense = (realIndex) => {
            if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ")){
                const expenses = getExpenses();
                expenses.splice(realIndex, 1);
                saveExpenses(expenses);
                renderExpense(document.getElementById('app-container'));
                lucide.createIcons();
            }
        };

        window.exportCSV = () => {
            const expenses = getExpenses();
            if (expenses.length === 0) return alert("æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡ºå–”ï¼");
            
            const csvContent = Papa.unparse(expenses);
            const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", "camino_expenses.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
        window.addEventListener('DOMContentLoaded', initApp);

    </script>
</body>
</html>