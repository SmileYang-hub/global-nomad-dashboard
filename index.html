<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“†å•¦Aå¤¢æ³¢çˆ¾åœ–å¤¢å¹»æ¢éšª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Nunito:wght@700;900&family=Noto+Sans+TC:wght@500;700;900&display=swap');
        
        :root {
            --dora-blue: #009BDE;
            --dora-red: #E4002B;
            --dora-yellow: #FFD700;
            --dora-white: #FFFFFF;
            --text-dark: #1e3a8a;
        }

        body { 
            font-family: 'Nunito', 'Noto Sans TC', sans-serif; 
            background-color: #f0f9ff;
            color: var(--text-dark);
            font-size: 18px; 
            margin: 0;
        }

        h1, h2, h3 { font-family: 'ZCOOL+KuaiLe', 'Noto Sans TC', sans-serif; font-weight: 900; }
        p, span, div, li { font-size: 1.1rem; }

        /* å“†å•¦Aå¤¢è£é£¾å…ƒç´  */
        .real-bell {
            width: 45px; height: 45px;
            background: radial-gradient(circle at 30% 30%, #fff000, #d4af37);
            border: 3px solid #8b4513; border-radius: 50%;
            position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .real-bell-hole {
            width: 10px; height: 10px; background: #8b4513; border-radius: 50%;
            position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%);
        }

        .itinerary-card {
            background: white; border-radius: 2.5rem;
            border: 5px solid var(--dora-blue);
            box-shadow: 0 15px 0px rgba(0, 155, 222, 0.15);
            overflow: hidden; margin-bottom: 2rem;
        }

        /* é–€ç¥¨æ„ŸæŒ‰éˆ• */
        .btn-action {
            background: var(--dora-red); color: white;
            padding: 1rem 2rem; border-radius: 1.5rem;
            font-weight: 900; border-bottom: 6px solid #b91c1c;
            transition: all 0.1s; display: inline-flex; align-items: center; gap: 0.5rem;
        }
        .btn-action:active { transform: translateY(3px); border-bottom-width: 2px; }

        .btn-play {
            background: var(--dora-blue); color: white;
            width: 50px; height: 50px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 0 #0077aa; cursor: pointer;
        }

        .nav-active { color: var(--dora-red); transform: scale(1.1); }
        
        /* æ²è»¸ç¾åŒ– */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: var(--dora-blue); border-radius: 10px; }
    </style>
</head>
<body class="pb-24">

    <!-- ä¸»é é¢ -->
    <div id="app-content">
        <header class="p-6 bg-blue-500 text-white sticky top-0 z-50 flex justify-between items-center border-b-8 border-white shadow-xl">
            <div class="flex items-center gap-4">
                <div class="real-bell">
                    <div class="real-bell-hole"></div>
                </div>
                <div>
                    <h1 class="text-3xl leading-none">æ³¢çˆ¾åœ–æ™‚å…‰å†’éšª</h1>
                    <p class="text-xs font-black opacity-80 mt-1 uppercase tracking-wider">Porto, Portugal ğŸ‡µğŸ‡¹</p>
                </div>
            </div>
            <div class="w-12 h-12 bg-white rounded-full p-1 border-2 border-blue-200">
                <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Dora" alt="Dora" class="w-full h-full">
            </div>
        </header>

        <main class="max-w-md mx-auto p-5 pb-20">
            <!-- è¡Œç¨‹åˆ†é  -->
            <section id="section-itinerary" class="space-y-8">
                <div class="flex items-center justify-between px-2">
                    <h2 class="text-3xl text-blue-600 flex items-center gap-2">
                        <i data-lucide="map-map" class="w-8 h-8"></i> æ¢éšªè·¯ç·š
                    </h2>
                    <select id="day-selector" onchange="updateDayView()" class="bg-white border-4 border-blue-500 rounded-2xl px-4 py-2 text-xl font-black text-blue-600 shadow-sm outline-none"></select>
                </div>
                <div id="itinerary-list" class="space-y-12"></div>
            </section>

            <!-- é“å…·ç®±åˆ†é  -->
            <section id="section-toolkit" class="hidden space-y-10">
                <h2 class="text-3xl text-blue-600 flex items-center gap-2 px-2">
                    <i data-lucide="backpack" class="w-8 h-8"></i> æ¢éšªå‚™å¿˜éŒ„
                </h2>
                
                <!-- è‡ªåŠ©å¿…å‚™ï¼šäº¤é€šå¡èªªæ˜ -->
                <div class="itinerary-card p-8 border-yellow-400 bg-yellow-50">
                    <h3 class="text-2xl text-yellow-700 flex items-center gap-2 mb-4">
                        <i data-lucide="train" class="w-8 h-8"></i> äº¤é€šé­”æ³•ï¼šAndante å¡
                    </h3>
                    <ul class="space-y-2 text-yellow-900 font-bold">
                        <li>â€¢ åœ¨æ©Ÿå ´åœ°éµç«™è²· Andante è—å¡ (0.6â‚¬)</li>
                        <li>â€¢ å„²å€¼ Z4 å€é–“å¯ä»¥å¾æ©Ÿå ´åˆ°å¸‚å€</li>
                        <li>â€¢ <span class="text-red-600 underline">é‡è¦ï¼š</span>é€²ç«™å‰ä¸€å®šè¦æ„Ÿæ‡‰æ©Ÿå°ï¼</li>
                    </ul>
                </div>

                <!-- ç¿»è­¯æ©Ÿ -->
                <div class="itinerary-card p-8">
                    <h3 class="text-2xl text-blue-600 flex items-center gap-2 mb-6">
                        <i data-lucide="mic-2" class="w-8 h-8"></i> è‘¡èªç¿»è­¯æ©Ÿ
                    </h3>
                    <div id="phrases-list" class="space-y-6"></div>
                </div>

                <!-- æª¢æŸ¥æ¸…å–® -->
                <div class="itinerary-card p-8 border-green-400 bg-green-50">
                    <h3 class="text-2xl text-green-700 flex items-center gap-2 mb-4">
                        <i data-lucide="check-square" class="w-8 h-8"></i> è¡Œæç™¾å¯¶è¢‹æ¸…å–®
                    </h3>
                    <div class="grid grid-cols-2 gap-3 font-bold text-green-800">
                        <label class="flex items-center gap-2"><input type="checkbox" checked> è¬ç”¨è½‰æ¥é ­</label>
                        <label class="flex items-center gap-2"><input type="checkbox"> æ­æ´²ç¶²å¡</label>
                        <label class="flex items-center gap-2"><input type="checkbox"> é‹å‹•é‹(çŸ³æ¿è·¯å¤š)</label>
                        <label class="flex items-center gap-2"><input type="checkbox"> é›¨å‚˜/è¼•ä¾¿é›¨è¡£</label>
                        <label class="flex items-center gap-2"><input type="checkbox"> è­·ç…§å½±æœ¬</label>
                        <label class="flex items-center gap-2"><input type="checkbox"> å‚™ç”¨é›»æ± </label>
                    </div>
                </div>
            </section>

            <!-- è¨˜å¸³åˆ†é  -->
            <section id="section-expense" class="hidden space-y-8">
                <h2 class="text-3xl text-blue-600 flex items-center gap-2 px-2">
                    <i data-lucide="wallet" class="w-8 h-8"></i> æ¢éšªå¸³æœ¬
                </h2>
                <div class="bg-gradient-to-br from-red-500 to-red-600 p-8 rounded-[3rem] text-white shadow-xl border-b-8 border-red-800">
                    <p class="font-bold opacity-80 mb-1 text-sm">ç›®å‰ç¸½èŠ±è²»</p>
                    <p id="total-expense" class="text-5xl font-black">â‚¬ 0.00</p>
                </div>
                
                <div class="itinerary-card p-8 space-y-4">
                    <div class="flex gap-2">
                        <input type="date" id="exp-date" class="flex-1 p-4 bg-gray-50 rounded-2xl font-bold border-none outline-none focus:ring-4 focus:ring-blue-100">
                    </div>
                    <input type="text" id="exp-item" placeholder="æ¶ˆè²»å…§å®¹ (å¦‚: è›‹å¡”)" class="w-full p-4 bg-gray-50 rounded-2xl font-bold border-none outline-none focus:ring-4 focus:ring-blue-100">
                    <input type="number" id="exp-amount" placeholder="é‡‘é¡ (â‚¬)" class="w-full p-4 bg-gray-50 rounded-2xl font-bold border-none outline-none focus:ring-4 focus:ring-blue-100">
                    <button onclick="addExpense()" class="w-full btn-action justify-center">æ”¾å…¥ç™¾å¯¶è¢‹</button>
                    <button onclick="exportToGoogleSheets()" class="w-full bg-green-500 text-white p-4 rounded-2xl font-black border-b-6 border-green-700 active:transform active:translate-y-1 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="file-spreadsheet"></i> åŒ¯å‡ºè‡³ Google Sheets (CSV)
                    </button>
                </div>
                <div id="expense-history" class="space-y-4"></div>
            </section>
        </main>

        <!-- å°èˆªåˆ— -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t-8 border-blue-500 h-24 px-6 flex justify-around items-center z-[1000] rounded-t-[3.5rem] shadow-2xl">
            <button onclick="showSection('itinerary')" class="nav-item flex flex-col items-center nav-active" id="nav-itinerary">
                <i data-lucide="map-pin" class="w-10 h-10"></i>
                <span class="font-black text-xs mt-1">å†’éšªè·¯ç·š</span>
            </button>
            <button onclick="showSection('toolkit')" class="nav-item flex flex-col items-center text-gray-300" id="nav-toolkit">
                <i data-lucide="briefcase" class="w-10 h-10"></i>
                <span class="font-black text-xs mt-1">è¡Œæèˆ‡é“å…·</span>
            </button>
            <button onclick="showSection('expense')" class="nav-item flex flex-col items-center text-gray-300" id="nav-expense">
                <i data-lucide="pocket" class="w-10 h-10"></i>
                <span class="font-black text-xs mt-1">æ”¯å‡ºè¨˜å¸³</span>
            </button>
        </nav>
    </div>

    <script>
        // å›ºå®šæ³¢çˆ¾åœ–è¡Œç¨‹è³‡æ–™
        const portoTrip = {
            name: "æ³¢çˆ¾åœ–å¤¢å¹»ä¸‰æ—¥éŠ",
            currency: "â‚¬",
            langCode: "pt-PT",
            survivalPhrases: [
                { tw: "ä½ å¥½", local: "OlÃ¡", pinyin: "Oh-la" },
                { tw: "è¬è¬", local: "Obrigado", pinyin: "Oh-bree-ga-doo" },
                { tw: "è«‹", local: "Por favor", pinyin: "Poor fah-vohr" },
                { tw: "è›‹å¡”", local: "Pastel de nata", pinyin: "Pash-tel de nah-tah" },
                { tw: "å¤šå°‘éŒ¢ï¼Ÿ", local: "Quanto custa?", pinyin: "Kwan-too koosh-tah" }
            ],
            itinerary: [
                {
                    day: 1,
                    locations: [
                        { 
                            name: "è–æœ¬ç¯¤è»Šç«™ (SÃ£o Bento)", 
                            time: "09:00", 
                            intro: "è¢«è­½ç‚ºä¸–ç•Œæœ€ç¾çš„ç«è»Šç«™ï¼å¤§å»³ç‰†é¢é‹ªæ»¿äº†å…©è¬ç‰‡è—ç™½è‰²ç“·ç£šï¼Œè¨´èªªè‘—è‘¡è„ç‰™çš„æ­·å²ã€‚é€™è£¡æ˜¯æ³¢çˆ¾åœ–çš„ä¸­å¿ƒï¼Œè‡ªåŠ©æ—…è¡Œçš„æœ€ä½³èµ·é»ã€‚", 
                            tips: "æ—©ä¸Šé™½å…‰é€é€²ä¾†æœ€ç¾ï¼Œå»ºè­°æ—©é»åˆ°é¿é–‹äººæ½®ã€‚",
                            mapUrl: "https://www.google.com/maps/search/SÃ£o+Bento+Station",
                            imgUrl: "https://images.unsplash.com/photo-1555881400-74d7acaacd8b?auto=format&fit=crop&w=800&q=80"
                        },
                        { 
                            name: "æ•™å£«å¡”èˆ‡æ•™å ‚", 
                            time: "11:30", 
                            intro: "æ³¢çˆ¾åœ–çš„åœ°æ¨™ï¼ä½ å¯ä»¥æŒ‘æˆ°çˆ¬ä¸Š 200 å¤šéšæ¨“æ¢¯åˆ°å¡”é ‚ï¼Œä¿¯ç°æ•´å€‹æ³¢çˆ¾åœ–è€åŸå€å’Œæœç¾…æ²³æ™¯ï¼Œéå¸¸éœ‡æ’¼ã€‚", 
                            tips: "é–€ç¥¨å¯ä»¥ç¾å ´è²·ï¼Œä½†æ—ºå­£å»ºè­°ç·šä¸Šé ç´„ã€‚",
                            mapUrl: "https://www.google.com/maps/search/ClÃ©rigos+Tower",
                            imgUrl: "https://images.unsplash.com/photo-1590424753364-585807663972?auto=format&fit=crop&w=800&q=80"
                        },
                        { 
                            name: "é‡Œè²æ‹‰å»£å ´ (Ribeira)", 
                            time: "15:00", 
                            intro: "æœç¾…æ²³ç•”æœ€ç†±é¬§çš„å€åŸŸã€‚å½©è‰²è€æˆ¿äº¤ç¹”ï¼Œé€™è£¡æœ‰è¨±å¤šå’–å•¡å»³ï¼Œé»ä¸€æ¯æ³¢ç‰¹é…’ååœ¨æ²³é‚Šï¼Œæ„Ÿå—æ‚ é–’çš„æ°›åœã€‚", 
                            tips: "é€™æ˜¯çœ‹è·¯æ˜“ä¸€ä¸–å¤§æ©‹çš„æœ€ä½³è§’åº¦ï¼Œä¹Ÿæ˜¯æ‹ç…§è–åœ°ã€‚",
                            mapUrl: "https://www.google.com/maps/search/Cais+da+Ribeira",
                            imgUrl: "https://images.unsplash.com/photo-1560582861-45078880e48e?auto=format&fit=crop&w=800&q=80"
                        }
                    ]
                },
                {
                    day: 2,
                    locations: [
                        { 
                            name: "è·¯æ˜“ä¸€ä¸–å¤§æ©‹ (ä¸Šå±¤æ­¥è¡Œ)", 
                            time: "10:00", 
                            intro: "é€™åº§éµæ©‹æ˜¯ç”±è‰¾è²çˆ¾éµå¡”è¨­è¨ˆè€…çš„å­¸ç”Ÿè¨­è¨ˆçš„ã€‚å»ºè­°ä¸€å®šè¦èµ°ä¸Šå±¤æ­¥é“ï¼Œé¢¨æ™¯çµ•ä½³ï¼Œé‚„å¯ä»¥çœ‹åœ°éµç©¿éèº«é‚Šã€‚", 
                            tips: "æ­¥è¡Œåˆ°æ²³å°å²¸çš„è“‹äºæ–°åŸ (Gaia) å¯ä»¥åƒè§€æ³¢ç‰¹é…’çª–ã€‚",
                            mapUrl: "https://www.google.com/maps/search/LuÃ­s+I+Bridge",
                            imgUrl: "https://images.unsplash.com/photo-1581439645268-ea7bbe6bd091?auto=format&fit=crop&w=800&q=80"
                        },
                        { 
                            name: "è“‹äºæ–°åŸé…’çª–å€", 
                            time: "14:00", 
                            intro: "æ³¢çˆ¾åœ–æœ€æœ‰åçš„æ³¢ç‰¹é…’å°±å„²å­˜åœ¨é€™è£¡ã€‚å„å¤§çŸ¥åé…’çª–å¦‚ Graham's, Sandeman éƒ½åœ¨é€™ï¼Œå¯ä»¥åƒåŠ å°è¦½èˆ‡å“é…’ã€‚", 
                            tips: "è¨˜å¾—é ç´„å“é…’å°è¦½ï¼Œå¯ä»¥äº†è§£è‘¡è„é…’çš„è£½ä½œæ­·å²ã€‚",
                            mapUrl: "https://www.google.com/maps/search/Port+Wine+Cellars+Gaia",
                            imgUrl: "https://images.unsplash.com/photo-1553121239-47087858c89b?auto=format&fit=crop&w=800&q=80"
                        }
                    ]
                },
                {
                    day: 3,
                    locations: [
                        { 
                            name: "å¡çˆ¾è«æ•™å ‚ (Carmo)", 
                            time: "10:00", 
                            intro: "é€™åº§æ•™å ‚çš„å´é¢æœ‰ä¸€é¢å·¨å¤§çš„è—ç“·ç£šç‰†ï¼Œæ˜¯IGä¸Šæœ€ç†±é–€çš„æ‰“å¡æ™¯é»ã€‚æ—é‚Šç·Šé„°è‘—ä¸€æ£Ÿå…¨åŸæœ€çª„çš„æˆ¿å­ã€‚", 
                            tips: "åƒè§€å®Œå¯ä»¥å»é™„è¿‘çš„èŠç¾…æ›¸åº— (Livraria Lello)ã€‚",
                            mapUrl: "https://www.google.com/maps/search/Carmo+Church+Porto",
                            imgUrl: "https://images.unsplash.com/photo-1570698473651-b2de99bae12f?auto=format&fit=crop&w=800&q=80"
                        }
                    ]
                }
            ]
        };

        let expenses = [];
        const today = new Date().toISOString().split('T')[0];

        window.onload = function() {
            document.getElementById('exp-date').value = today;
            initApp();
        };

        function initApp() {
            const selector = document.getElementById('day-selector');
            selector.innerHTML = portoTrip.itinerary.map(d => `<option value="${d.day}">Day ${d.day}</option>`).join('');

            document.getElementById('phrases-list').innerHTML = portoTrip.survivalPhrases.map(p => `
                <div class="flex items-center justify-between bg-blue-50 p-6 rounded-3xl border-2 border-blue-100">
                    <div>
                        <p class="text-sm font-black text-blue-400 mb-1">${p.tw}</p>
                        <p class="text-3xl font-black text-blue-900">${p.local}</p>
                        <p class="text-lg text-gray-400 font-bold">${p.pinyin}</p>
                    </div>
                    <button onclick="speak('${p.local}')" class="btn-play">
                        <i data-lucide="volume-2" class="w-6 h-6"></i>
                    </button>
                </div>
            `).join('');

            updateDayView();
            lucide.createIcons();
        }

        function updateDayView() {
            const day = document.getElementById('day-selector').value;
            const dayData = portoTrip.itinerary.find(d => d.day == day);
            const list = document.getElementById('itinerary-list');
            list.innerHTML = dayData.locations.map((loc, i) => `
                <div class="itinerary-card">
                    <div class="h-64 relative">
                        <img src="${loc.imgUrl}" alt="${loc.name}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"></div>
                        <div class="absolute bottom-6 left-8 text-white">
                            <span class="bg-red-500 px-3 py-1 rounded-lg text-xs font-black mb-2 inline-block">â± ${loc.time}</span>
                            <h3 class="text-3xl font-black">${loc.name}</h3>
                        </div>
                    </div>
                    <div class="p-8 space-y-4">
                        <p class="text-gray-600 font-bold leading-relaxed border-l-4 border-blue-400 pl-4">${loc.intro}</p>
                        <div class="bg-yellow-50 p-4 rounded-2xl border-2 border-dashed border-yellow-300">
                            <p class="text-yellow-800 text-sm font-black">ğŸ’¡ å“†å•¦Aå¤¢æç¤ºï¼š${loc.tips}</p>
                        </div>
                        <a href="${loc.mapUrl}" target="_blank" class="btn-action w-full justify-center">
                            <i data-lucide="navigation"></i> é–‹å•Ÿåœ°åœ–å°èˆª
                        </a>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function showSection(id) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`section-${id}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => {
                n.classList.remove('nav-active');
                n.classList.add('text-gray-300');
            });
            document.getElementById(`nav-${id}`).classList.add('nav-active');
            document.getElementById(`nav-${id}`).classList.remove('text-gray-300');
            window.scrollTo(0, 0);
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = portoTrip.langCode;
            window.speechSynthesis.speak(utterance);
        }

        function addExpense() {
            const date = document.getElementById('exp-date').value;
            const item = document.getElementById('exp-item').value;
            const amount = parseFloat(document.getElementById('exp-amount').value);
            
            if(!item || isNaN(amount)) return;
            
            expenses.unshift({ date, item, amount });
            renderExpenses();
            
            // é‡ç½®è¡¨å–®
            document.getElementById('exp-item').value = '';
            document.getElementById('exp-amount').value = '';
        }

        function renderExpenses() {
            const list = document.getElementById('expense-history');
            let total = 0;
            list.innerHTML = expenses.map(e => {
                total += e.amount;
                return `
                    <div class="bg-white p-6 rounded-[2rem] shadow-sm flex justify-between items-center border-2 border-blue-50">
                        <div>
                            <p class="text-xs text-gray-400 font-black">${e.date}</p>
                            <p class="text-xl font-black text-blue-900">${e.item}</p>
                        </div>
                        <span class="text-2xl font-black text-red-500">${portoTrip.currency} ${e.amount.toFixed(2)}</span>
                    </div>
                `;
            }).join('');
            document.getElementById('total-expense').innerText = `${portoTrip.currency} ${total.toFixed(2)}`;
        }

        function exportToGoogleSheets() {
            if (expenses.length === 0) return alert("ç›®å‰é‚„æ²’æœ‰è¨˜å¸³è³‡æ–™å–”ï¼");
            
            // å»ºç«‹ CSV å…§å®¹
            let csvContent = "\uFEFFæ—¥æœŸ,é …ç›®,é‡‘é¡(â‚¬)\n"; // åŠ å…¥ BOM è§£æ±ºä¸­æ–‡äº‚ç¢¼
            expenses.forEach(e => {
                csvContent += `${e.date},${e.item},${e.amount}\n`;
            });

            // å»ºç«‹ä¸‹è¼‰é€£çµ
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `æ³¢çˆ¾åœ–æ¢éšªå¸³æœ¬_${today}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert("å·²ç”¢ç”Ÿ CSV æª”æ¡ˆï¼ä½ å¯ä»¥ç›´æ¥å°‡æ­¤æª”æ¡ˆåŒ¯å…¥ Google Sheetsã€‚");
        }

        lucide.createIcons();
    </script>
</body>
</html>